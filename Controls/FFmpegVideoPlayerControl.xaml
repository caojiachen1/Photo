<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Photo.Controls.FFmpegVideoPlayerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="#1F1F1F">

    <UserControl.Resources>
        <Storyboard x:Name="FadeInStoryboard">
            <DoubleAnimation Storyboard.TargetName="TransportControlsPanel"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.2"/>
        </Storyboard>
        <Storyboard x:Name="FadeOutStoryboard">
            <DoubleAnimation Storyboard.TargetName="TransportControlsPanel"
                             Storyboard.TargetProperty="Opacity"
                             From="1" To="0" Duration="0:0:0.2"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid>
        <!-- 视频显示 -->
        <Image x:Name="VideoImage"
               Stretch="Uniform"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"/>

        <!-- 自定义传输控件 -->
        <Grid x:Name="TransportControlsPanel"
              VerticalAlignment="Bottom"
              HorizontalAlignment="Center"
              Visibility="Collapsed"
              Opacity="0"
              Margin="0,0,0,16"
              Background="#2A2A2A"
              CornerRadius="6"
              Padding="8,4"
              Height="40">
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 播放/暂停 -->
            <Button x:Name="PlayPauseButton"
                    Grid.Column="0"
                    Click="PlayPauseButton_Click"
                    Width="32" Height="32"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    ToolTipService.ToolTip="Play/Pause">
                <FontIcon x:Name="PlayPauseIcon" Glyph="&#xE768;" FontSize="14" Foreground="White"/>
            </Button>

            <!-- 快退10秒 -->
            <Button x:Name="RewindButton"
                    Grid.Column="1"
                    Click="RewindButton_Click"
                    Width="32" Height="32"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    ToolTipService.ToolTip="Rewind 10s">
                <FontIcon Glyph="&#xE892;" FontSize="12" Foreground="White"/>
            </Button>

            <!-- 快进30秒 -->
            <Button x:Name="ForwardButton"
                    Grid.Column="2"
                    Click="ForwardButton_Click"
                    Width="32" Height="32"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    ToolTipService.ToolTip="Forward 30s">
                <FontIcon Glyph="&#xE893;" FontSize="12" Foreground="White"/>
            </Button>

            <!-- 音量 -->
            <Button x:Name="VolumeButton"
                    Grid.Column="3"
                    Click="VolumeButton_Click"
                    Width="32" Height="32"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    ToolTipService.ToolTip="Mute/Unmute">
                <FontIcon x:Name="VolumeIcon" Glyph="&#xE74F;" FontSize="14" Foreground="White"/>
            </Button>

            <!-- Current Time -->
            <TextBlock x:Name="CurrentTimeText" 
                       Grid.Column="4" 
                       Text="00:00" 
                       VerticalAlignment="Center" 
                       Margin="8,0,6,0" 
                       Foreground="White" 
                       FontSize="11"/>

            <!-- 进度条 -->
            <Slider x:Name="ProgressSlider"
                    Grid.Column="5"
                    VerticalAlignment="Center"
                    Margin="0"
                    Height="32"
                    IsThumbToolTipEnabled="False"
                    ValueChanged="ProgressSlider_ValueChanged"/>

            <!-- Total Time -->
            <TextBlock x:Name="TotalTimeText" 
                       Grid.Column="6" 
                       Text="00:00" 
                       VerticalAlignment="Center" 
                       Margin="6,0,8,0" 
                       Foreground="White" 
                       FontSize="11"/>

            <!-- 循环 -->
            <Button x:Name="RepeatButton"
                    Grid.Column="7"
                    Click="RepeatButton_Click"
                    Width="32" Height="32"
                    Background="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    ToolTipService.ToolTip="Repeat">
                <FontIcon x:Name="RepeatIcon" Glyph="&#xE8EE;" FontSize="14" Foreground="#80FFFFFF"/>
            </Button>
        </Grid>

        <!-- 加载指示器 -->
        <ProgressRing x:Name="LoadingRing"
                      Width="60"
                      Height="60"
                      IsActive="False"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
    </Grid>
</UserControl>
